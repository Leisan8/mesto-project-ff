(()=>{"use strict";const e="https://nomoreparties.co/v1/wff-cohort-37",t={authorization:"bb1d456e-eba6-4c51-b0d8-becd4ada6370"};function o(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}function r(r){return fetch(`${e}/cards/likes/${r}`,{method:"PUT",headers:{authorization:t.authorization}}).then(o)}function n(r){return fetch(`${e}/cards/likes/${r}`,{method:"DELETE",headers:{authorization:t.authorization}}).then(o)}const a=document.querySelector("#card-template").content;function c(e,t,o,r,n=0,c=null){const i=a.querySelector(".places__item").cloneNode(!0),u=i.querySelector(".card__image"),l=i.querySelector(".card__like-counter"),s=i.querySelector(".card__like-button");return e.likes.some((e=>e._id==c))&&s.classList.add("card__like-button_is-active"),u.src=e.link,u.alt=e.name,l.textContent=n,i.querySelector(".card__title").textContent=e.name,null===t?i.querySelector(".card__delete-button").remove():i.querySelector(".card__delete-button").addEventListener("click",(()=>t(i,e._id))),o(u,e),i.querySelector(".card__like-button").addEventListener("click",(t=>{r(t,e._id,s,l)})),i}function i(r,n){(function(r){return fetch(`${e}/cards/${r}`,{method:"DELETE",headers:{authorization:t.authorization}}).then(o)})(n).then((()=>{r.remove()})).catch((e=>console.log(e)))}function u(e,t,o,a){(o.classList.contains("card__like-button_is-active")?n:r)(t).then((e=>{o.classList.toggle("card__like-button_is-active"),a.textContent=e.likes.length})).catch((e=>{console.error("Like action failed:",e)}))}function l(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");if(!e)return;p(e)}}function s(e){e.classList.add("popup_is-opened"),e.classList.remove("popup_is-animated"),document.addEventListener("keydown",l)}function p(e){e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),document.removeEventListener("keydown",l)}const d=(e,t,o,r)=>{t.classList.remove(o),e.classList.remove(r),e.textContent=""};function _(e,t){const o=e.querySelectorAll(t.inputSelector);o.forEach((o=>{d(e.querySelector(`.${o.id}-error`),o,t.inputErrorClass,t.errorClass)})),m(o,e.querySelector(t.submitButtonSelector),t.inactiveButtonClass)}const m=(e,t,o)=>{(e=>Array.from(e).some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(o)):(t.disabled=!1,t.classList.remove(o))},y=document.querySelector(".places__list"),h=document.querySelector(".popup_type_image"),f=document.forms["edit-profile"],S=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),b=document.querySelector(".profile__avatar"),C=document.querySelector(".popup_type_avatar"),k=document.querySelector(".profile__edit-button"),E=document.querySelector(".popup_type_edit"),g=document.querySelector(".profile__add-button"),L=document.querySelector(".popup_type_new-card"),x=document.querySelectorAll(".popup__close"),$=document.querySelectorAll(".popup"),z=C.querySelector(".popup__form"),T=E.querySelector(".popup__form"),A=T.querySelector(".popup__input_type_name"),B=T.querySelector(".popup__input_type_description"),P=L.querySelector(".popup__form"),j=P.querySelector(".popup__input_type_card-name"),w=P.querySelector(".popup__input_type_url"),D=document.querySelector(".profile__title"),N=document.querySelector(".profile__description");function O(e,t){e.addEventListener("click",(()=>{h.querySelector(".popup__image").src=e.src,h.querySelector(".popup__image").alt=t.name,h.querySelector(".popup__caption").textContent=t.name,s(h)}))}k.addEventListener("click",(()=>{s(E),f.elements.name.value=S.textContent,f.elements.description.value=v.textContent})),g.addEventListener("click",(()=>{_(L.querySelector(".popup__form"),J),s(L)})),x.forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest(".popup");p(t);const o=t.querySelector(".popup__form");o&&_(o,J)}))})),$.forEach((e=>{e.addEventListener("click",(t=>{if(t.target===e){p(e);const o=t.target.closest(".popup").querySelector(".popup__form");o&&_(o,J)}}))})),T.addEventListener("submit",(function(r){r.preventDefault();const n=r.target.querySelector('button[type="submit"]'),a=n.textContent;var c,i;n.textContent="Сохранение...",(c=A.value,i=B.value,fetch(`${e}/users/me`,{method:"PATCH",headers:{authorization:t.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:c,about:i})}).then(o)).then((e=>{p(E),D.textContent=e.name,N.textContent=e.about})).catch((e=>console.log(e))).finally((()=>{n.textContent=a}))})),P.addEventListener("submit",(function(r){r.preventDefault();const n=r.target.querySelector('button[type="submit"]'),a=n.textContent;n.textContent="Сохранение...";var l,s;(l=j.value,s=w.value,fetch(`${e}/cards`,{method:"POST",headers:{authorization:t.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:l,link:s})}).then(o)).then((e=>{const t=c({name:e.name,link:e.link,likes:e.likes,_id:e._id},i,O,u);y.prepend(t),j.value="",w.value="",p(L)})).catch((e=>{console.error("Error loading data:",e)})).finally((()=>{n.textContent=a}))}));const J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};var M;M=J,document.querySelectorAll(M.formSelector).forEach((e=>{const t=e.querySelectorAll(M.inputSelector);t.forEach((o=>{o.addEventListener("input",(()=>{var r,n,a,c;r=o,n=e.querySelector(`.${o.id}-error`),a=M.inputErrorClass,c=M.errorClass,r.validity.valid?d(n,r,a,c):((e,t,o,r,n)=>{t.classList.add(r),e.textContent=o,e.classList.add(n)})(n,r,r.validity.patternMismatch?r.dataset.errorMessage:r.validationMessage,a,c),m(t,e.querySelector(M.submitButtonSelector),M.inactiveButtonClass)}))}))})),Promise.all([fetch(`${e}/users/me`,{headers:t}).then(o),fetch(`${e}/cards`,{headers:t}).then(o)]).then((([e,t])=>{const o=e._id;S.textContent=e.name,v.textContent=e.about,q.style.backgroundImage=`url('${e.avatar}')`,t.forEach((e=>y.append(c(e,e.owner._id===o?i:null,O,u,e.likes.length,o))))})).catch((e=>{console.error("Error loading data:",e)})),b.addEventListener("click",(e=>{_(C.querySelector(".popup__form"),J),s(C)})),z.addEventListener("submit",(r=>{r.preventDefault();const n=r.target.querySelector('button[type="submit"]'),a=n.textContent;n.textContent="Сохранение...";const c=r.target.closest(".popup").querySelector(".popup__form");var i;(i=C.querySelector(".popup__input_type_url").value,fetch(`${e}/users/me/avatar`,{method:"PATCH",headers:{authorization:t.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:i})}).then(o)).then((e=>{q.style.backgroundImage=`url('${e.avatar}')`,p(C),_(c,J)})).catch((e=>console.log(e))).finally((()=>{n.textContent=a}))}))})();