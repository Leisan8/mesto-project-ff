(()=>{"use strict";const e="https://nomoreparties.co/v1/wff-cohort-37",t={authorization:"bb1d456e-eba6-4c51-b0d8-becd4ada6370"};function o(e){return fetch(`https://nomoreparties.co/v1/wff-cohort-37/cards/likes/${e}`,{method:"PUT",headers:{authorization:t.authorization}}).then((e=>e.json())).catch((e=>console.log(e)))}function r(e){return fetch(`https://nomoreparties.co/v1/wff-cohort-37/cards/likes/${e}`,{method:"DELETE",headers:{authorization:t.authorization}}).then((e=>e.json())).catch((e=>console.log(e)))}const n=document.querySelector("#card-template").content;function c(e,t,o,r,c=0){const a=n.querySelector(".places__item").cloneNode(!0),i=a.querySelector(".card__image"),u=a.querySelector(".card__like-counter");return i.src=e.link,i.alt=e.name,u.textContent=c,a.querySelector(".card__title").textContent=e.name,null===t?a.querySelector(".card__delete-button").remove():a.querySelector(".card__delete-button").addEventListener("click",(()=>t(a,e._id))),o(i,e),a.querySelector(".card__like-button").addEventListener("click",(t=>{r(t,e._id)})),a}function a(e,o){!function(e){fetch(`https://nomoreparties.co/v1/wff-cohort-37/cards/${e}`,{method:"DELETE",headers:{authorization:t.authorization}}).catch((e=>console.log(e)))}(o),e.remove()}function i(e,t){const n=e.target,c=n.closest(".card__likes").querySelector(".card__like-counter");(n.classList.contains("card__like-button_is-active")?r:o)(t).then((e=>{n.classList.toggle("card__like-button_is-active"),c.textContent=e.likes.length})).catch((e=>{console.error("Like action failed:",e)}))}function u(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");if(!e)return;l(e)}}function s(e){e.classList.add("popup_is-opened"),e.classList.remove("popup_is-animated"),document.addEventListener("keydown",u)}function l(e){e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),document.removeEventListener("keydown",u)}const p=(e,t,o,r)=>{t.classList.remove(o),e.classList.remove(r),e.textContent=""};function d(e,t){e.querySelectorAll(t.inputSelector).forEach((o=>{p(e.querySelector(`.${o.id}-error`),o,t.inputErrorClass,t.errorClass)}))}const _=document.querySelector(".places__list"),m=document.querySelector(".popup_type_image"),y=document.forms["edit-profile"],h=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),v=document.querySelector(".profile__image"),S=document.querySelector(".profile__avatar"),q=document.querySelector(".popup_type_avatar"),E=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit"),g=document.querySelector(".profile__add-button"),L=document.querySelector(".popup_type_new-card"),k=document.querySelectorAll(".popup__close"),C=document.querySelectorAll(".popup"),z=document.querySelector("#submit-avatar"),x=b.querySelector(".popup__form"),w=x.querySelector(".popup__input_type_name"),T=x.querySelector(".popup__input_type_description"),$=L.querySelector(".popup__form"),A=$.querySelector(".popup__input_type_card-name"),j=$.querySelector(".popup__input_type_url"),D=document.querySelector(".profile__title"),P=document.querySelector(".profile__description");function B(e,t){e.addEventListener("click",(()=>{m.querySelector(".popup__image").src=e.src,m.querySelector(".popup__image").alt=t.name,m.querySelector(".popup__caption").textContent=t.name,s(m)}))}E.addEventListener("click",(()=>{s(b),y.elements.name.value=h.textContent,y.elements.description.value=f.textContent})),g.addEventListener("click",(()=>s(L))),k.forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest(".popup");l(t),d(t.querySelector(".popup__form"),N)}))})),C.forEach((e=>{e.addEventListener("click",(t=>{t.target===e&&(l(e),d(t.target.closest(".popup").querySelector(".popup__form"),N))}))})),x.addEventListener("submit",(function(e){e.preventDefault();const o=w.value,r=T.value;D.textContent=o,P.textContent=r,function(e,o){fetch("https://nomoreparties.co/v1/wff-cohort-37/users/me",{method:"PATCH",headers:{authorization:t.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).catch((e=>console.log(e)))}(o,r),l(b)})),$.addEventListener("submit",(function(e){e.preventDefault();const o=A.value,r=j.value,n=c({name:o,link:r},a,B,i);var u,s;u=o,s=r,fetch("https://nomoreparties.co/v1/wff-cohort-37/cards",{method:"POST",headers:{authorization:t.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:u,link:s})}).catch((e=>console.log(e))),_.prepend(n),A.value="",j.value="",l(L)}));const N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};var O;O=N,document.querySelectorAll(O.formSelector).forEach((e=>{const t=e.querySelectorAll(O.inputSelector);t.forEach((o=>{o.addEventListener("input",(()=>{var r,n,c,a,i,u,s;a=o,i=e.querySelector(`.${o.id}-error`),u=O.inputErrorClass,s=O.errorClass,a.validity.valid?p(i,a,u,s):((e,t,o,r,n)=>{t.classList.add(r),e.textContent=o,e.classList.add(n)})(i,a,a.validity.patternMismatch?a.dataset.errorMessage:a.validationMessage,u,s),r=t,n=e.querySelector(O.submitButtonSelector),c=O.inactiveButtonClass,(e=>Array.from(e).some((e=>!e.validity.valid)))(r)?(n.disabled=!0,n.classList.add(c)):(n.disabled=!1,n.classList.remove(c))}))}))})),Promise.all([fetch(`${e}/users/me`,{headers:t}).then((e=>e.json())),fetch(`${e}/cards`,{headers:t}).then((e=>e.json()))]).then((([e,t])=>{const o=e._id;h.textContent=e.name,f.textContent=e.about,v.style.backgroundImage=`url('${e.avatar}')`,t.forEach((e=>_.append(c(e,e.owner._id===o?a:null,B,i,e.likes.length))))})).catch((e=>{console.error("Error loading data:",e)})),S.addEventListener("click",(e=>{s(q)})),z.addEventListener("click",(e=>{e.preventDefault();const o=q.querySelector(".popup__input_type_url").value;var r;v.style.backgroundImage=`url('${o}')`,r=o,fetch("https://nomoreparties.co/v1/wff-cohort-37/users/me/avatar ",{method:"PATCH",headers:{authorization:t.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})}).catch((e=>console.log(e)));const n=e.target.closest(".popup").querySelector(".popup__form");l(q),d(n,N)}))})();