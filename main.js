(()=>{"use strict";const e="https://nomoreparties.co/v1/wff-cohort-37",t={authorization:"bb1d456e-eba6-4c51-b0d8-becd4ada6370"};function o(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}function r(r){return fetch(`${e}/cards/likes/${r}`,{method:"PUT",headers:{authorization:t.authorization}}).then(o)}function n(r){return fetch(`${e}/cards/likes/${r}`,{method:"DELETE",headers:{authorization:t.authorization}}).then(o)}const c=document.querySelector("#card-template").content;function a(e,t,o,r,n=0,a=null){const i=c.querySelector(".places__item").cloneNode(!0),u=i.querySelector(".card__image"),l=i.querySelector(".card__like-counter"),s=i.querySelector(".card__like-button");return e.likes.some((e=>e._id==a))&&s.classList.add("card__like-button_is-active"),u.src=e.link,u.alt=e.name,l.textContent=n,i.querySelector(".card__title").textContent=e.name,null===t?i.querySelector(".card__delete-button").remove():i.querySelector(".card__delete-button").addEventListener("click",(()=>t(i,e._id))),o(u,e),i.querySelector(".card__like-button").addEventListener("click",(t=>{r(t,e._id,s,l)})),i}function i(r,n){(function(r){return fetch(`${e}/cards/${r}`,{method:"DELETE",headers:{authorization:t.authorization}}).then(o)})(n).then((()=>{r.remove()})).catch((e=>console.log(e)))}function u(e,t,o,c){(o.classList.contains("card__like-button_is-active")?n:r)(t).then((e=>{o.classList.toggle("card__like-button_is-active"),c.textContent=e.likes.length})).catch((e=>{console.error("Like action failed:",e)}))}function l(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");if(!e)return;p(e)}}function s(e){e.classList.add("popup_is-opened"),e.classList.remove("popup_is-animated"),document.addEventListener("keydown",l)}function p(e){e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),document.removeEventListener("keydown",l)}const d=(e,t,o,r)=>{t.classList.remove(o),e.classList.remove(r),e.textContent=""};function _(e,t){e.querySelectorAll(t.inputSelector).forEach((o=>{d(e.querySelector(`.${o.id}-error`),o,t.inputErrorClass,t.errorClass)}))}const m=document.querySelector(".places__list"),y=document.querySelector(".popup_type_image"),h=document.forms["edit-profile"],f=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),v=document.querySelector(".profile__image"),q=document.querySelector(".profile__avatar"),b=document.querySelector(".popup_type_avatar"),C=document.querySelector(".profile__edit-button"),E=document.querySelector(".popup_type_edit"),g=document.querySelector(".profile__add-button"),L=document.querySelector(".popup_type_new-card"),k=document.querySelectorAll(".popup__close"),x=document.querySelectorAll(".popup"),$=b.querySelector(".popup__form"),z=E.querySelector(".popup__form"),T=z.querySelector(".popup__input_type_name"),A=z.querySelector(".popup__input_type_description"),P=L.querySelector(".popup__form"),j=P.querySelector(".popup__input_type_card-name"),w=P.querySelector(".popup__input_type_url"),D=document.querySelector(".profile__title"),B=document.querySelector(".profile__description");function N(e,t){e.addEventListener("click",(()=>{y.querySelector(".popup__image").src=e.src,y.querySelector(".popup__image").alt=t.name,y.querySelector(".popup__caption").textContent=t.name,s(y)}))}C.addEventListener("click",(()=>{s(E),h.elements.name.value=f.textContent,h.elements.description.value=S.textContent})),g.addEventListener("click",(()=>s(L))),k.forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest(".popup");p(t);const o=t.querySelector(".popup__form");o&&_(o,O)}))})),x.forEach((e=>{e.addEventListener("click",(t=>{if(t.target===e){p(e);const o=t.target.closest(".popup").querySelector(".popup__form");o&&_(o,O)}}))})),z.addEventListener("submit",(function(r){r.preventDefault();const n=r.target.querySelector('button[type="submit"]'),c=n.textContent;n.textContent="Сохранение...";const a=T.value,i=A.value;(function(r,n){return fetch(`${e}/users/me`,{method:"PATCH",headers:{authorization:t.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:r,about:n})}).then(o)})(a,i).then((()=>{p(E),D.textContent=a,B.textContent=i})).catch((e=>console.log(e))).finally((()=>{n.textContent=c}))})),P.addEventListener("submit",(function(r){r.preventDefault();const n=r.target.querySelector('button[type="submit"]'),c=n.textContent;n.textContent="Сохранение...";const l=j.value,s=w.value,d={name:l,link:s};var _,y;(_=l,y=s,fetch(`${e}/cards`,{method:"POST",headers:{authorization:t.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:_,link:y})}).then(o)).then((()=>{const e=a(d,i,N,u);m.prepend(e),j.value="",w.value="",p(L)})).catch((e=>{console.error("Error loading data:",e)})).finally((()=>{n.textContent=c}))}));const O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};var J;J=O,document.querySelectorAll(J.formSelector).forEach((e=>{const t=e.querySelectorAll(J.inputSelector);t.forEach((o=>{o.addEventListener("input",(()=>{var r,n,c,a,i,u,l;a=o,i=e.querySelector(`.${o.id}-error`),u=J.inputErrorClass,l=J.errorClass,a.validity.valid?d(i,a,u,l):((e,t,o,r,n)=>{t.classList.add(r),e.textContent=o,e.classList.add(n)})(i,a,a.validity.patternMismatch?a.dataset.errorMessage:a.validationMessage,u,l),r=t,n=e.querySelector(J.submitButtonSelector),c=J.inactiveButtonClass,(e=>Array.from(e).some((e=>!e.validity.valid)))(r)?(n.disabled=!0,n.classList.add(c)):(n.disabled=!1,n.classList.remove(c))}))}))})),Promise.all([fetch(`${e}/users/me`,{headers:t}).then(o),fetch(`${e}/cards`,{headers:t}).then(o)]).then((([e,t])=>{const o=e._id;f.textContent=e.name,S.textContent=e.about,v.style.backgroundImage=`url('${e.avatar}')`,t.forEach((e=>m.append(a(e,e.owner._id===o?i:null,N,u,e.likes.length,o))))})).catch((e=>{console.error("Error loading data:",e)})),q.addEventListener("click",(e=>{s(b)})),$.addEventListener("submit",(r=>{r.preventDefault();const n=r.target.querySelector('button[type="submit"]'),c=n.textContent;n.textContent="Сохранение...";const a=r.target.closest(".popup").querySelector(".popup__form"),i=b.querySelector(".popup__input_type_url").value;var u;(u=i,fetch(`${e}/users/me/avatar`,{method:"PATCH",headers:{authorization:t.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:u})}).then(o)).then((()=>{v.style.backgroundImage=`url('${i}')`,p(b),_(a,O)})).catch((e=>console.log(e))).finally((()=>{n.textContent=c}))}))})();